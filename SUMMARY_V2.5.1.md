# V2.5.1 æ›´æ–°æ€»ç»“

## âœ… å·²å®Œæˆçš„ä»»åŠ¡

### 1. ğŸ› ä¿®å¤SSLè¿æ¥é”™è¯¯

**é—®é¢˜**ï¼š
- APIè¯·æ±‚å› SSLé”™è¯¯å¤±è´¥
- æ— é‡è¯•æœºåˆ¶ï¼Œä¸€æ¬¡å¤±è´¥å°±æ”¾å¼ƒ

**è§£å†³æ–¹æ¡ˆ**ï¼š
```python
# æ·»åŠ æŒ‡æ•°é€€é¿é‡è¯•æœºåˆ¶
async def get_account_data_async(address, retry_count=3):
    for attempt in range(retry_count):
        try:
            # ... è·å–æ•°æ® ...
            return data
        except Exception:
            await asyncio.sleep(2 ** attempt)  # 1s, 2s, 4s
            continue
```

**æ•ˆæœ**ï¼š
- âœ… å¤±è´¥åè‡ªåŠ¨é‡è¯•ï¼ˆæœ€å¤š3æ¬¡ï¼‰
- âœ… æŒ‡æ•°é€€é¿é¿å…è¿‡åº¦è¯·æ±‚
- âœ… æé«˜APIè°ƒç”¨æˆåŠŸç‡
- âœ… æ—¥å¿—æ˜¾ç¤ºé‡è¯•è¿›åº¦

---

### 2. ğŸ”§ ä¿®å¤asyncio DeprecationWarning

**é—®é¢˜**ï¼š
```
DeprecationWarning: There is no current event loop
  loop = asyncio.get_event_loop()
```

**è§£å†³æ–¹æ¡ˆ**ï¼š

**position_manager.py**:
```python
# ä¿®æ”¹å‰
loop = asyncio.get_event_loop()

# ä¿®æ”¹å
loop = asyncio.get_running_loop()
```

**monitor_whales.py**:
```python
# ä¿®æ”¹å‰
loop = asyncio.get_event_loop()
all_data = loop.run_until_complete(coro)

# ä¿®æ”¹å
all_data = asyncio.run(coro)
```

**æ•ˆæœ**ï¼š
- âœ… æ¶ˆé™¤DeprecationWarning
- âœ… ç¬¦åˆPython 3.10+æœ€ä½³å®è·µ
- âœ… ä»£ç æ›´ç®€æ´

---

### 3. ğŸ“Š åœ¨äº¤æ˜“é€šçŸ¥ä¸­è¾“å‡ºè´¦æˆ·å®Œæ•´ä¿¡æ¯

**æ–°å¢æ˜¾ç¤º**ï¼š
```
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ“Š è´¦æˆ·æ±‡æ€»ä¿¡æ¯ ğŸ”¥ğŸ”¥ğŸ”¥
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ’¼ è´¦æˆ·æ€»ä»·å€¼: $124,680,000.00
ğŸ“ˆ æŒä»“æ€»ä»·å€¼: $124,680,000.00
ğŸ’° Total PnL: $3,580,000.00
```

**å®ç°æ–¹å¼**ï¼š
- ä»ç¼“å­˜è¯»å–è´¦æˆ·æ•°æ®ï¼ˆ5åˆ†é’ŸTTLï¼‰
- æ˜¾ç¤ºè´¦æˆ·æ€»ä»·å€¼ã€æŒä»“ä»·å€¼ã€Total PnL
- ä½¿ç”¨çº¿ç¨‹æ± æ‰§è¡Œå¼‚æ­¥è°ƒç”¨ï¼Œé¿å…é˜»å¡

**æ•ˆæœ**ï¼š
- âœ… æ¯æ¬¡äº¤æ˜“é€šçŸ¥éƒ½èƒ½çœ‹åˆ°å®Œæ•´è´¦æˆ·ä¿¡æ¯
- âœ… ä»ç¼“å­˜è¯»å–ï¼Œå“åº”å¿«é€Ÿ
- âœ… ä¸å½±å“äº¤æ˜“é€šçŸ¥çš„å®æ—¶æ€§

---

### 4. ğŸ”¥ åŸºäºTotal PnLæ·»åŠ Fire Emojiç­‰çº§

**ç­‰çº§ç³»ç»Ÿ**ï¼š

| Total PnL | Emoji | è¯´æ˜ |
|-----------|-------|------|
| â‰¥ $10M | ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ | è¶…çº§å¤§æˆ· |
| â‰¥ $5M | ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ | é¡¶çº§äº¤æ˜“å‘˜ |
| â‰¥ $1M | ğŸ”¥ğŸ”¥ğŸ”¥ | ç™¾ä¸‡ç›ˆåˆ© |
| â‰¥ $500K | ğŸ”¥ğŸ”¥ | é«˜æ‰‹ |
| â‰¥ $100K | ğŸ”¥ | ç›ˆåˆ© |
| > $0 | âœ¨ | å°ç›ˆåˆ© |
| $0 | â– | æŒå¹³ |
| > -$100K | â„ï¸ | å°äºæŸ |
| > -$500K | â„ï¸â„ï¸ | äºæŸ |
| > -$1M | â„ï¸â„ï¸â„ï¸ | è¾ƒå¤§äºæŸ |
| > -$5M | â„ï¸â„ï¸â„ï¸â„ï¸ | é‡å¤§äºæŸ |
| â‰¤ -$5M | â„ï¸â„ï¸â„ï¸â„ï¸â„ï¸ | ä¸¥é‡äºæŸ |

**å®ç°ä»£ç **ï¼š
```python
def _get_pnl_fire_emoji(self, total_pnl: float) -> str:
    """æ ¹æ®Total PnLè¿”å›å¯¹åº”çš„fire emoji"""
    if total_pnl >= 10_000_000:
        return "ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥"
    elif total_pnl >= 5_000_000:
        return "ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥"
    # ... æ›´å¤šç­‰çº§
```

**æ•ˆæœ**ï¼š
- âœ… ä¸€çœ¼å°±èƒ½çœ‹å‡ºäº¤æ˜“å‘˜çš„ç›ˆåˆ©æ°´å¹³
- âœ… ç›ˆåˆ©ç”¨ç«ç„°ğŸ”¥ï¼ŒäºæŸç”¨å†°å—â„ï¸
- âœ… ç­‰çº§åˆ†æ˜ï¼Œç›´è§‚æ˜“æ‡‚

---

## ğŸ“ ä¿®æ”¹çš„æ–‡ä»¶

### position_manager.py
```diff
+ async def get_account_data_async(address, force_refresh=False, retry_count=3):
+     for attempt in range(retry_count):
+         try:
-             loop = asyncio.get_event_loop()
+             loop = asyncio.get_running_loop()
              # ...
+             return account_data
+         except Exception as e:
+             if attempt < retry_count - 1:
+                 await asyncio.sleep(2 ** attempt)
+             else:
+                 logging.error(f"å·²é‡è¯•{retry_count}æ¬¡")
```

### monitor_whales.py
```diff
+ def _get_pnl_fire_emoji(self, total_pnl: float) -> str:
+     if total_pnl >= 10_000_000:
+         return "ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥"
+     # ...

  def start_monitoring(self):
-     loop = asyncio.get_event_loop()
-     all_data = loop.run_until_complete(...)
+     all_data = asyncio.run(...)

  def _notify_trade(self, trade_info):
+     # è·å–è´¦æˆ·æ•°æ®
+     account_data = asyncio.run(
+         self.position_manager.get_account_data_async(user_addr)
+     )
+     
+     # æ˜¾ç¤ºè´¦æˆ·ä¿¡æ¯
+     fire_emoji = self._get_pnl_fire_emoji(total_pnl)
+     print(f"ğŸ“Š è´¦æˆ·æ±‡æ€»ä¿¡æ¯ {fire_emoji}")
+     print(f"ğŸ’¼ è´¦æˆ·æ€»ä»·å€¼: ${account_value:,.2f}")
+     print(f"ğŸ“ˆ æŒä»“æ€»ä»·å€¼: ${total_position_value:,.2f}")
+     print(f"ğŸ’° Total PnL: ${total_pnl:,.2f}")
```

### README.md
```diff
- # Hyperliquid å¤§æˆ·ç›‘æ§å™¨ V2.5.0
+ # Hyperliquid å¤§æˆ·ç›‘æ§å™¨ V2.5.1

+ ## ğŸ› V2.5.1 Bugä¿®å¤ (2025-10-21)
+ 
+ ğŸ”§ **ä¿®å¤SSLè¿æ¥é”™è¯¯** - æ·»åŠ æŒ‡æ•°é€€é¿é‡è¯•æœºåˆ¶
+ ğŸ”§ **ä¿®å¤asyncioè­¦å‘Š** - ä½¿ç”¨asyncio.run()
+ âœ¨ **è´¦æˆ·ä¿¡æ¯å¢å¼º** - æ˜¾ç¤ºè´¦æˆ·ä»·å€¼ã€æŒä»“ä»·å€¼ã€Total PnL
+ ğŸ”¥ **Fire Emojiç­‰çº§** - æ ¹æ®Total PnLæ˜¾ç¤ºç«ç„°/å†°å—emoji

+ #### ğŸ”¥ Fire Emojiç­‰çº§è¯´æ˜
+ (æ·»åŠ emojiç­‰çº§è¡¨æ ¼)
```

---

## ğŸ¯ å®é™…æ•ˆæœæ¼”ç¤º

### äº¤æ˜“é€šçŸ¥è¾“å‡ºï¼ˆå®Œæ•´ç‰ˆï¼‰

```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â¬‡ï¸  å‡ä»“
    (Close Short)
â° æ—¶é—´: 2025-10-21 22:08:18
ğŸ‘¤ ç”¨æˆ·: 0xd47587702a91731dc1089b5db0932cf820151a91
ğŸ’ å¸ç§: ENA
ğŸ“Š æ–¹å‘: ä¹°å…¥ (Bid)
ğŸ“ˆ æ•°é‡: 15,243.0000
ğŸ’µ ä»·æ ¼: $0.4437
ğŸ’° äº¤æ˜“ä»·å€¼: $6,763.32
ğŸ“ˆ ä»“ä½: -11,392,036.0000 â†’ -11,376,793.0000 (å˜åŒ–: +15,243.0000)
ğŸ¯ å…¥åœºä»·: $0.4479
ğŸ’° æœ¬æ¬¡å·²å®ç°ç›ˆäº: $63.59 (ç›ˆåˆ©)
ğŸ“Š å‰©ä½™æŒä»“æœªå®ç°ç›ˆäº: $58,390.88 (æµ®ç›ˆ)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ“Š è´¦æˆ·æ±‡æ€»ä¿¡æ¯ ğŸ”¥ğŸ”¥ğŸ”¥  â† æ–°å¢ï¼šFire Emojiç­‰çº§
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ’¼ è´¦æˆ·æ€»ä»·å€¼: $5,234,567.00       â† æ–°å¢
ğŸ“ˆ æŒä»“æ€»ä»·å€¼: $4,890,123.00       â† æ–°å¢
ğŸ’° Total PnL: $1,234,567.00        â† æ–°å¢

ğŸ“Š æŒä»“å‰ä¸‰ï¼ˆæŒ‰ä»·å€¼ï¼‰:
   1. ğŸ”´ ENA | $4,850,000.00 | PnL: +$58,390.88
   2. ğŸŸ¢ BTC | $40,123.00 | PnL: +$1,234.56
   3. ğŸ”´ ETH | $23,456.00 | PnL: -$234.56

ğŸ“‹ æŒ‚å•å‰ä¸‰ï¼ˆæŒ‰ä»·å€¼ï¼‰:
   1. ğŸŸ¢ BTC | ä¹°å…¥ @ $65,000.0000 | ä»·å€¼: $65,000.00
   2. ğŸ”´ ETH | å–å‡º @ $3,500.0000 | ä»·å€¼: $35,000.00
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

---

## ğŸ“Š æ€§èƒ½å½±å“

### APIè°ƒç”¨æˆåŠŸç‡
- **ä¿®æ”¹å‰**ï¼šä¸€æ¬¡å¤±è´¥ = å®Œå…¨å¤±è´¥
- **ä¿®æ”¹å**ï¼šæœ€å¤šé‡è¯•3æ¬¡ï¼ŒæˆåŠŸç‡å¤§å¹…æå‡

### å“åº”æ—¶é—´
- **æ­£å¸¸æƒ…å†µ**ï¼šæ— é¢å¤–å»¶è¿Ÿï¼ˆç¬¬1æ¬¡æˆåŠŸï¼‰
- **ç½‘ç»œæŠ–åŠ¨**ï¼šé¢å¤–1-7ç§’ï¼ˆé‡è¯•1-3æ¬¡ï¼‰
- **è´¦æˆ·ä¿¡æ¯**ï¼šä»ç¼“å­˜è¯»å–ï¼Œ<100ms

---

## ğŸ¯ é€‚ç”¨åœºæ™¯

### é€‚åˆä»¥ä¸‹ç”¨æˆ·
âœ… ç›‘æ§å¤§æˆ·äº¤æ˜“æ´»åŠ¨  
âœ… éœ€è¦å®æ—¶è´¦æˆ·ä¿¡æ¯  
âœ… æƒ³å¿«é€Ÿåˆ¤æ–­äº¤æ˜“å‘˜æ°´å¹³  
âœ… ç½‘ç»œä¸ç¨³å®šç¯å¢ƒ  

### å…¸å‹ä½¿ç”¨æµç¨‹
1. å¯åŠ¨ç¨‹åºï¼š`python3 monitor_whales.py`
2. ç­‰å¾…åˆå§‹åŒ–ï¼ˆè·å–æ‰€æœ‰åœ°å€æ•°æ®ï¼‰
3. å®æ—¶ç›‘æ§äº¤æ˜“é€šçŸ¥
4. é€šè¿‡Fire Emojiå¿«é€Ÿè¯†åˆ«é¡¶çº§äº¤æ˜“å‘˜
5. æŸ¥çœ‹è´¦æˆ·æ±‡æ€»ä¿¡æ¯äº†è§£èµ„é‡‘çŠ¶å†µ
6. æŸ¥çœ‹HTMLæŠ¥å‘Šè·å–å®Œæ•´æŒä»“è¯¦æƒ…

---

## ğŸš€ å‡çº§æŒ‡å—

ä»V2.5.0å‡çº§åˆ°V2.5.1ï¼š

```bash
# 1. å¤‡ä»½ï¼ˆå¯é€‰ï¼‰
cp position_manager.py position_manager.py.bak
cp monitor_whales.py monitor_whales.py.bak

# 2. æ›´æ–°ä»£ç 
git pull

# 3. é‡å¯ç›‘æ§
python3 monitor_whales.py
```

**æ— éœ€ä¿®æ”¹é…ç½®æ–‡ä»¶**ï¼Œå®Œå…¨å‘åå…¼å®¹ï¼

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- âœ… `BUGFIX_V2.5.1.md` - è¯¦ç»†bugä¿®å¤è¯´æ˜
- âœ… `CHANGELOG_V2.5.0.md` - V2.5.0åŠŸèƒ½è¯´æ˜
- âœ… `README.md` - å®Œæ•´ä½¿ç”¨æ–‡æ¡£

---

## ğŸ”® åç»­è®¡åˆ’

1. **PnLå†å²æ•°æ®**
   - æœ¬åœ°è®°å½•è´¦æˆ·ä»·å€¼å†å²
   - è®¡ç®—çœŸå®çš„24h/7d/30d PnL

2. **æ›´æ™ºèƒ½çš„é‡è¯•**
   - æ ¹æ®é”™è¯¯ç±»å‹è°ƒæ•´é‡è¯•ç­–ç•¥
   - 429é”™è¯¯ä½¿ç”¨æ›´é•¿ç­‰å¾…æ—¶é—´

3. **é€šçŸ¥ä¼˜åŒ–**
   - æ·»åŠ è´¦æˆ·ä»·å€¼è¶‹åŠ¿ï¼ˆâ†‘â†“ï¼‰
   - æ˜¾ç¤ºæŒä»“å æ¯”

4. **åœ°å€æ ‡ç­¾**
   - ä»é…ç½®æ–‡ä»¶è¯»å–åœ°å€æ˜µç§°
   - åœ¨é€šçŸ¥ä¸­æ˜¾ç¤ºæ ‡ç­¾

---

## ğŸ™ åé¦ˆ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿æIssueï¼

**ç‰ˆæœ¬**: V2.5.1  
**å‘å¸ƒæ—¥æœŸ**: 2025-10-21  
**çŠ¶æ€**: âœ… ç¨³å®šç‰ˆ

