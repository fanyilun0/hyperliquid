# Hyperliquid 大户交易监控系统

基于Hyperliquid官方API和Python SDK的实时大户交易监控工具。

## 功能特性

- ✅ 自动从leaderboard中筛选正收益前10名交易者
- ✅ 实时监控大户的开仓、平仓、加仓、减仓行为
- ✅ 准确追踪每个地址的持仓状态
- ✅ 自动计算已实现盈亏
- ✅ 支持多个时间窗口筛选（日/周/月/全时）

## 系统架构

```
┌─────────────────────┐
│  leaderboard.json   │  ← Hyperliquid排行榜数据
└──────────┬──────────┘
           │
           ▼
┌─────────────────────┐
│ filter_top_traders  │  ← 筛选正收益前10名
│       .py           │
└──────────┬──────────┘
           │
           ▼
┌─────────────────────┐
│ top_traders_        │  ← 存储筛选结果
│  addresses.json     │
└──────────┬──────────┘
           │
           ▼
┌─────────────────────┐
│  monitor_whales.py  │  ← 实时监控交易
└─────────────────────┘
           │
           ▼
   实时交易通知 🔔
```

## 快速开始

### 1. 安装依赖

```bash
pip install -r requirements.txt
```

### 2. 筛选大户地址

```bash
python filter_top_traders.py
```

这将：
- 读取 `leaderboard.json` 文件
- 筛选出正收益前10名交易者
- 将结果保存到 `top_traders_addresses.json`
- 在控制台显示详细信息

### 3. 开始监控

```bash
python monitor_whales.py
```

这将：
- 加载筛选出的地址列表
- 订阅这些地址的实时交易事件
- 在控制台显示开仓、平仓等关键交易行为

## 使用示例

### 选择不同的时间窗口

编辑 `filter_top_traders.py`，修改时间窗口参数：

```python
# 可选值: 'day', 'week', 'month', 'allTime'
addresses = get_top_traders(top_n=10, time_window="month")
```

### 输出示例

```
================================================================================
正收益前10名交易者 (时间窗口: allTime)
================================================================================

排名 #1
  地址: 0x1234567890abcdef...
  账户价值: $1,234,567.89
  盈亏 (PnL): $567,890.12
  收益率 (ROI): 45.67%
  交易量: $12,345,678.90

...

================================================================================
监控中... (按Ctrl+C停止)
================================================================================

🟢 开仓 | 2025-10-15T14:30:25.123456
   用户: 0x12345678...abcdef12
   币种: BTC
   方向: 买入
   数量: 1.5
   价格: $67,890.00
   仓位: 0.0000 → 1.5000
```

## 核心逻辑说明

### 仓位状态机

程序通过维护本地仓位状态，将WebSocket推送的增量数据转换为业务事件：

| 原仓位 | 新仓位 | 判定 |
|--------|--------|------|
| 0 | ≠0 | 开仓 |
| ≠0 | 0 | 平仓 |
| 正 | 负 (或反之) | 反向开仓 |
| 仓位增大 | - | 加仓 |
| 仓位减小 | - | 减仓 |

### API限制说明

⚠️ **重要**: Hyperliquid限制每个IP地址最多监控10个用户的userEvents

如需监控超过10个地址，需要：
- 使用代理服务器池分散IP
- 部署到多个服务器实例
- 实现分布式架构

## 文件说明

| 文件 | 说明 |
|------|------|
| `filter_top_traders.py` | 从leaderboard筛选大户地址 |
| `monitor_whales.py` | 实时监控交易活动 |
| `leaderboard.json` | 排行榜原始数据（从API获取） |
| `top_traders_addresses.json` | 筛选后的地址列表（自动生成） |
| `requirements.txt` | Python依赖包 |
| `guide.md` | 技术方案文档 |

## 数据更新

### 更新排行榜数据

```bash
# 从Hyperliquid API获取最新排行榜
curl -o leaderboard.json https://stats-data.hyperliquid.xyz/Mainnet/leaderboard
```

建议设置定时任务（如cron）每小时更新一次排行榜数据。

## 扩展功能

可以在 `monitor_whales.py` 中添加更多功能：

- 💬 集成Telegram/Discord通知
- 📊 记录交易历史到数据库
- 📈 计算跟单收益统计
- 🎯 设置仓位变化阈值过滤
- 📧 邮件/短信告警

## 技术参考

详细技术方案请参阅 [guide.md](guide.md)

## 注意事项

1. 确保网络连接稳定，WebSocket需要持续连接
2. 排行榜数据是快照，非实时更新（通常分钟级）
3. 监控程序需要持续运行，建议使用 `screen` 或 `tmux`
4. 注意API速率限制，避免频繁请求

## 许可证

MIT License

