# 地址过滤功能使用说明

## 📋 功能概述

地址过滤功能允许你跳过某些不想监控的地址，特别适用于：
- 🤖 高频交易机器人（频繁开平仓）
- 🔁 量化策略账户
- 🚫 其他不感兴趣的地址

## 📁 配置文件说明

### 1. `address_filters.json` - 过滤规则配置

这是一个独立的过滤配置文件，支持三种过滤方式：

```json
{
  "description": "地址过滤配置 - 用于跳过特定地址或显示名称",
  "filters": {
    "blocked_addresses": [
      "0xecb63caa47c7c4e77f60f1ce858cf28dc2b82b00"
    ],
    "blocked_display_names": [
      "Bot",
      "bot",
      "机器人",
      "量化"
    ],
    "blocked_keywords": [
      "bot",
      "robot",
      "quant"
    ]
  }
}
```

#### 过滤规则说明

| 配置项 | 说明 | 匹配方式 |
|--------|------|----------|
| `blocked_addresses` | 屏蔽的地址列表 | 完全匹配（不区分大小写） |
| `blocked_display_names` | 屏蔽的显示名称 | 完全匹配（区分大小写） |
| `blocked_keywords` | 屏蔽的关键词 | 包含匹配（不区分大小写） |

### 2. `top_traders_addresses.json` - 地址列表中的block标记

你也可以直接在地址文件中标记某个地址为blocked：

```json
{
  "ethAddress": "0xecb63caa47c7c4e77f60f1ce858cf28dc2b82b00",
  "accountValue": 83345174.730314,
  "pnl": 134617495.080314,
  "displayName": "Bot",
  "block": true
}
```

## 🎯 过滤优先级

过滤检查按以下顺序进行：

1. **文件中的block标记** - 最高优先级
2. **blocked_addresses** - 地址黑名单
3. **blocked_display_names** - 显示名称完全匹配
4. **blocked_keywords** - 显示名称包含关键词

任何一个条件满足，该地址就会被跳过。

## 📝 使用示例

### 示例 1: 屏蔽单个地址

**场景**: 某个地址 `0xecb63caa...b00` 是高频交易机器人，不想监控

**方法1**: 在 `address_filters.json` 中添加：
```json
{
  "filters": {
    "blocked_addresses": [
      "0xecb63caa47c7c4e77f60f1ce858cf28dc2b82b00"
    ]
  }
}
```

**方法2**: 在 `top_traders_addresses.json` 的details中标记：
```json
{
  "ethAddress": "0xecb63caa47c7c4e77f60f1ce858cf28dc2b82b00",
  "block": true
}
```

### 示例 2: 屏蔽所有机器人账户

**场景**: 不想监控所有显示名称包含"bot"的账户

**配置** `address_filters.json`:
```json
{
  "filters": {
    "blocked_keywords": [
      "bot",
      "robot",
      "机器人"
    ]
  }
}
```

这将屏蔽所有displayName包含这些关键词的地址，例如：
- "Trading Bot"
- "My Robot Strategy"
- "量化机器人"

### 示例 3: 屏蔽特定显示名称

**场景**: 只屏蔽显示名称完全是"Bot"的账户

**配置** `address_filters.json`:
```json
{
  "filters": {
    "blocked_display_names": [
      "Bot"
    ]
  }
}
```

注意：这是**完全匹配**，"Bot" 会被屏蔽，但 "My Bot" 不会。

## 🚀 运行效果

启动监控器时，会看到详细的过滤统计：

```
================================================================================
📋 地址过滤统计
================================================================================
✅ 有效地址: 9 个
🚫 屏蔽地址: 1 个

🚫 已屏蔽的地址:
   1. 0xecb63caa47c7c4e77f60f1ce858cf28dc2b82b00 (Bot)
      原因: 在地址文件中标记为blocked
================================================================================

✅ 将监控 9 个地址
```

## ⚙️ 配置建议

### 推荐配置 1: 屏蔽所有机器人

适用于只想监控人工交易者：

```json
{
  "filters": {
    "blocked_keywords": [
      "bot",
      "robot",
      "quant",
      "algo",
      "机器人",
      "量化",
      "自动"
    ]
  }
}
```

### 推荐配置 2: 仅屏蔽特定地址

适用于大部分账户都想监控，只排除个别：

```json
{
  "filters": {
    "blocked_addresses": [
      "0xecb63caa47c7c4e77f60f1ce858cf28dc2b82b00",
      "0x另一个地址..."
    ]
  }
}
```

### 推荐配置 3: 组合使用

```json
{
  "filters": {
    "blocked_addresses": [
      "0xecb63caa47c7c4e77f60f1ce858cf28dc2b82b00"
    ],
    "blocked_keywords": [
      "bot",
      "machine",
      "机器"
    ],
    "blocked_display_names": [
      "Test Account",
      "测试账户"
    ]
  }
}
```

## 🔧 管理过滤规则

### 添加新的屏蔽地址

1. 编辑 `address_filters.json`
2. 在 `blocked_addresses` 数组中添加地址
3. 重启监控器

### 临时取消过滤

如果想临时不应用过滤（监控所有地址）：

**方法1**: 重命名或删除 `address_filters.json`
```bash
mv address_filters.json address_filters.json.bak
```

**方法2**: 清空所有过滤规则
```json
{
  "filters": {
    "blocked_addresses": [],
    "blocked_display_names": [],
    "blocked_keywords": []
  }
}
```

### 查看哪些地址被屏蔽

运行监控器时会自动显示，或者查看日志：

```bash
python3 monitor_whales_v2.py 2>&1 | grep "已屏蔽"
```

## 📊 过滤统计

每次启动监控器时，会显示：
- ✅ 有效地址数量
- 🚫 屏蔽地址数量
- 📋 每个被屏蔽地址的详细信息（地址、显示名称、屏蔽原因）

## 💡 使用技巧

### 1. 逐步添加屏蔽规则

建议先运行一段时间，观察哪些地址太吵：
```bash
# 运行监控，观察哪些地址交易频繁
python3 monitor_whales_v2.py

# 记下不想监控的地址或显示名称
# 然后添加到 address_filters.json
```

### 2. 使用关键词过滤

比人工维护地址列表更高效：
- 关键词 "bot" 可以匹配 "Trading Bot", "My Bot", "bot123" 等
- 不区分大小写，"Bot" 和 "bot" 都会被匹配

### 3. 区分完全匹配和包含匹配

- `blocked_display_names`: 完全匹配，适用于精确屏蔽
- `blocked_keywords`: 包含匹配，适用于模糊屏蔽

### 4. 结合使用两种方式

- `address_filters.json`: 适合通用规则（如所有bot）
- `top_traders_addresses.json` 的 `block` 标记: 适合特定地址

## ⚠️ 注意事项

1. **大小写敏感性**
   - 地址匹配：不区分大小写
   - 显示名称完全匹配：区分大小写
   - 关键词匹配：不区分大小写

2. **配置文件格式**
   - 必须是有效的JSON格式
   - 使用UTF-8编码
   - 地址必须是完整的以太坊地址格式

3. **重启生效**
   - 修改配置后需要重启监控器才能生效

4. **过滤日志**
   - 被过滤的地址会在启动时显示
   - 不会创建WebSocket连接
   - 不会消耗订阅限额

## 🔍 调试

如果过滤没有按预期工作，启用DEBUG模式：

```json
// config.json
{
  "debug": true
}
```

然后查看详细日志：
```bash
python3 monitor_whales_v2.py 2>&1 | grep -A 5 "过滤"
```

## 📚 相关文件

- `address_filters.json` - 过滤规则配置
- `top_traders_addresses.json` - 地址列表（支持block标记）
- `config.json` - 主配置文件
- `monitor_whales_v2.py` - 监控程序

## 🆘 常见问题

**Q: 如果不创建 `address_filters.json` 会怎样？**
A: 程序会正常运行，只是不应用过滤规则（除了文件中的block标记）

**Q: 可以同时使用两种屏蔽方式吗？**
A: 可以！文件中的 `block: true` 和 `address_filters.json` 中的规则会同时生效

**Q: 如何知道一个地址的displayName？**
A: 查看 `top_traders_addresses.json` 的 `details` 部分，或在[Hyperliquid网站](https://app.hyperliquid.xyz/)查询地址

**Q: 过滤后还能改回来吗？**
A: 可以！从配置文件中删除相应规则，重启监控器即可

## 🎯 最佳实践

1. **先观察，再过滤** - 运行一段时间后再决定过滤哪些
2. **使用关键词** - 比维护地址列表更灵活
3. **保留重要的** - 不要过度过滤，可能错过重要信号
4. **定期审查** - 定期检查过滤规则是否仍然合适
5. **备份配置** - 修改前备份 `address_filters.json`

---

更新时间: 2025-10-16
版本: 1.0

