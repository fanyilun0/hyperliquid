# Changelog V2.5.0

## ğŸ¯ ç‰ˆæœ¬æ¦‚è§ˆ

**ç‰ˆæœ¬å·**: V2.5.0  
**å‘å¸ƒæ—¥æœŸ**: 2025-10-21  
**ä¸»é¢˜**: æ™ºèƒ½ç¼“å­˜æœºåˆ¶ + è´¦æˆ·æ•°æ®æ±‡æ€» + æ¨¡å—åŒ–é‡æ„

---

## âœ¨ æ–°å¢åŠŸèƒ½

### 1. æ™ºèƒ½ç¼“å­˜æœºåˆ¶

**æ–‡ä»¶**: `position_manager.py`

æ–°å¢ç¼“å­˜ç®¡ç†åŠŸèƒ½ï¼Œé¿å…é¢‘ç¹APIè°ƒç”¨ï¼š

- âœ… **5åˆ†é’Ÿè‡ªåŠ¨åˆ·æ–°**: ç¼“å­˜æ—¶é—´ä¸º300ç§’ï¼Œè¿‡æœŸè‡ªåŠ¨æ›´æ–°
- âœ… **å¼‚æ­¥å¹¶å‘**: æ”¯æŒå¤šåœ°å€å¹¶å‘è·å–æ•°æ®
- âœ… **é”æœºåˆ¶**: ä½¿ç”¨ `asyncio.Lock` é˜²æ­¢å¹¶å‘æ›´æ–°åŒä¸€åœ°å€
- âœ… **å¼ºåˆ¶åˆ·æ–°**: æ”¯æŒ `force_refresh` å‚æ•°å¼ºåˆ¶æ›´æ–°

**æ ¸å¿ƒæ–¹æ³•**:
```python
async def get_account_data_async(address, force_refresh=False)
    â†’ è¿”å›è´¦æˆ·æ•°æ®ï¼ˆå¸¦ç¼“å­˜ï¼‰
```

**æ•°æ®ç»“æ„**:
```python
{
    'user_state': {...},           # ç”¨æˆ·çŠ¶æ€
    'address': str,                 # ç”¨æˆ·åœ°å€
    'account_value': float,         # è´¦æˆ·æ€»ä»·å€¼
    'total_position_value': float,  # æŒä»“æ€»ä»·å€¼
    'positions': [...],             # æŒä»“åˆ—è¡¨
    'pnl_summary': {                # PnLæ±‡æ€»
        'total_pnl': float,
        'unrealized_pnl': float,
        'pnl_24h': float,           # 24å°æ—¶PnL
        'pnl_48h': float,           # 48å°æ—¶PnL
        'pnl_7d': float,            # 7å¤©PnL
        'pnl_30d': float,           # 30å¤©PnL
    },
    'open_orders': [...],           # æŒ‚å•åˆ—è¡¨
    'timestamp': str                # æ•°æ®æ—¶é—´æˆ³
}
```

---

### 2. è´¦æˆ·æ•°æ®æ±‡æ€»æ˜¾ç¤º

**æ–‡ä»¶**: `monitor_whales.py` - `_notify_trade()` æ–¹æ³•

äº¤æ˜“é€šçŸ¥ç°åœ¨åŒ…å«ä¸°å¯Œçš„è´¦æˆ·ä¿¡æ¯ï¼š

#### ğŸ“Š è´¦æˆ·æ±‡æ€»
- ğŸ’¼ è´¦æˆ·æ€»ä»·å€¼
- ğŸ“ˆ æŒä»“æ€»ä»·å€¼
- ğŸ’° Total PnL
- ğŸ“… é˜¶æ®µæ€§PnLï¼ˆ24h/48h/7d/30dï¼‰

#### ğŸ† æŒä»“å‰ä¸‰ï¼ˆæŒ‰ä»·å€¼ï¼‰
```
1. ğŸ”´ BTC | $124,680,000.00 | PnL: +$3,580,000.00
2. ğŸŸ¢ ETH | $2,340,000.00 | PnL: +$120,000.00
3. ğŸ”´ HYPE | $890,000.00 | PnL: -$45,000.00
```

#### ğŸ“‹ æŒ‚å•å‰ä¸‰ï¼ˆæŒ‰ä»·å€¼ï¼‰
```
1. ğŸŸ¢ BTC | ä¹°å…¥ @ $65,000.0000 | ä»·å€¼: $650,000.00
2. ğŸ”´ ETH | å–å‡º @ $3,500.0000 | ä»·å€¼: $350,000.00
```

---

### 3. å®šæœŸæ•°æ®æ›´æ–°

**æ–‡ä»¶**: `monitor_whales.py`

æ–°å¢åå°å®šæœŸæ›´æ–°ä»»åŠ¡ï¼š

- âœ… **5åˆ†é’Ÿè‡ªåŠ¨æ›´æ–°**: åå°å¼‚æ­¥ä»»åŠ¡å®šæœŸåˆ·æ–°æ•°æ®
- âœ… **è‡ªåŠ¨ç”ŸæˆæŠ¥å‘Š**: æ¯æ¬¡æ›´æ–°åé‡æ–°ç”ŸæˆHTMLæŠ¥å‘Š
- âœ… **ä¼˜é›…é€€å‡º**: æ”¯æŒå–æ¶ˆä»»åŠ¡ï¼Œé¿å…èµ„æºæ³„æ¼

**æ ¸å¿ƒæ–¹æ³•**:
```python
async def _periodic_data_update():
    while running:
        await asyncio.sleep(300)  # 5åˆ†é’Ÿ
        await position_manager.update_and_generate_report_async(...)
```

---

### 4. æ¨¡å—åŒ–é‡æ„

**æ–°æ–‡ä»¶**: `create_html.py`

å°†HTMLç”Ÿæˆé€»è¾‘ä» `position_manager.py` ä¸­åˆ†ç¦»ï¼š

- âœ… **èŒè´£åˆ†ç¦»**: PositionManageråªè´Ÿè´£æ•°æ®è·å–ï¼ŒHTMLç”Ÿæˆç‹¬ç«‹
- âœ… **æ›´æ˜“ç»´æŠ¤**: HTMLæ ·å¼å’Œé€»è¾‘é›†ä¸­ç®¡ç†
- âœ… **å¯æ‰©å±•**: æ–¹ä¾¿æ·»åŠ æ–°çš„æ˜¾ç¤ºç»„ä»¶

**æ ¸å¿ƒå‡½æ•°**:
```python
def generate_position_table_html(address, account_data) â†’ str
def generate_html_report(all_account_data, output_file) â†’ None
```

---

### 5. å¢å¼ºçš„HTMLæŠ¥å‘Š

**æ–‡ä»¶**: `create_html.py`

HTMLæŠ¥å‘Šæ–°å¢ä»¥ä¸‹å†…å®¹ï¼š

#### åœ°å€çº§åˆ«ç»Ÿè®¡
- è´¦æˆ·æ€»ä»·å€¼
- æŒä»“æ€»ä»·å€¼
- æŒä»“æ•°é‡
- æŒ‚å•æ•°é‡

#### PnLå¡ç‰‡ç»„
```html
[Total PnL] [24-Hour PnL] [48-Hour PnL] [7-Day PnL] [30-Day PnL]
```

#### æŒä»“å‰ä¸‰ & æŒ‚å•å‰ä¸‰
- æŒ‰ä»·å€¼æ’åºçš„Top 3æŒä»“
- æŒ‰ä»·å€¼æ’åºçš„Top 3æŒ‚å•
- è¿·ä½ è¡¨æ ¼å±•ç¤ºï¼Œä¸€ç›®äº†ç„¶

---

## ğŸ”§ ä¿®æ”¹å†…å®¹

### position_manager.py

**æ–°å¢**:
- `cache_ttl` - ç¼“å­˜æ—¶é—´ï¼ˆ300ç§’ï¼‰
- `account_data_cache` - æ•°æ®ç¼“å­˜å­—å…¸
- `update_locks` - å¼‚æ­¥é”å­—å…¸
- `get_account_data_async()` - å¸¦ç¼“å­˜çš„æ•°æ®è·å–
- `get_top_positions()` - è·å–æŒä»“å‰N
- `get_top_open_orders()` - è·å–æŒ‚å•å‰N
- `update_and_generate_report_async()` - æ›´æ–°å¹¶ç”ŸæˆæŠ¥å‘Š

**åˆ é™¤**:
- `_save_html_report()` - ç§»è‡³ `create_html.py`
- `generate_position_table_html()` - ç§»è‡³ `create_html.py`

---

### monitor_whales.py

**æ–°å¢**:
- `position_manager` - æŒä»“ç®¡ç†å™¨å®ä¾‹ï¼ˆå¸¦ç¼“å­˜ï¼‰
- `update_task` - å®šæœŸæ›´æ–°ä»»åŠ¡
- `_periodic_data_update()` - å®šæœŸæ›´æ–°æ–¹æ³•
- äº¤æ˜“é€šçŸ¥ä¸­çš„è´¦æˆ·æ±‡æ€»ã€æŒä»“å‰ä¸‰ã€æŒ‚å•å‰ä¸‰æ˜¾ç¤º

**ä¿®æ”¹**:
- `start_monitoring()` - ä½¿ç”¨æ–°çš„ `update_and_generate_report_async()`
- å¯åŠ¨å®šæœŸæ›´æ–°ä»»åŠ¡
- åœæ­¢æ—¶å–æ¶ˆå®šæœŸæ›´æ–°ä»»åŠ¡

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### ç¼“å­˜æ•ˆæœ
- âŒ **ä¹‹å‰**: æ¯æ¬¡äº¤æ˜“é€šçŸ¥éƒ½è°ƒç”¨APIè·å–æ•°æ®ï¼ˆå»¶è¿Ÿé«˜ï¼‰
- âœ… **ç°åœ¨**: ä½¿ç”¨5åˆ†é’Ÿç¼“å­˜ï¼Œäº¤æ˜“é€šçŸ¥ç§’çº§å“åº”

### APIè°ƒç”¨ä¼˜åŒ–
- âŒ **ä¹‹å‰**: æ¯æ¬¡äº‹ä»¶éƒ½é‡æ–°è·å–æ•°æ®
- âœ… **ç°åœ¨**: 
  - åˆå§‹åŒ–æ—¶è·å–ä¸€æ¬¡
  - æ¯5åˆ†é’Ÿåå°åˆ·æ–°
  - äº¤æ˜“é€šçŸ¥ç›´æ¥è¯»ç¼“å­˜

### å¹¶å‘æ§åˆ¶
- âœ… ä½¿ç”¨ `asyncio.Semaphore` æ§åˆ¶å¹¶å‘æ•°ï¼ˆé»˜è®¤10ï¼‰
- âœ… ä½¿ç”¨ `asyncio.Lock` é˜²æ­¢é‡å¤æ›´æ–°

---

## ğŸ§ª æµ‹è¯•

æ–°å¢æµ‹è¯•è„šæœ¬: `test_position_manager.py`

æµ‹è¯•å†…å®¹:
1. âœ… é¦–æ¬¡è·å–æ•°æ®ï¼ˆä»APIï¼‰
2. âœ… å†æ¬¡è·å–ï¼ˆä½¿ç”¨ç¼“å­˜ï¼‰
3. âœ… è·å–æŒä»“å‰ä¸‰
4. âœ… è·å–æŒ‚å•å‰ä¸‰
5. âœ… å¼ºåˆ¶åˆ·æ–°

**è¿è¡Œæµ‹è¯•**:
```bash
python3 test_position_manager.py
```

---

## ğŸ“ APIé™åˆ¶è¯´æ˜

### PnLæ•°æ®è·å–

âš ï¸ **é‡è¦æç¤º**: 

ç›®å‰Hyperliquid APIçš„ `user_state` æ¥å£åªæä¾›ï¼š
- âœ… `unrealizedPnl` - æœªå®ç°ç›ˆäºï¼ˆå½“å‰æŒä»“ï¼‰
- âŒ ä¸ç›´æ¥æä¾›å†å²PnLï¼ˆ24h/7d/30dï¼‰

**å½“å‰å®ç°**:
- `total_pnl` = æ‰€æœ‰æŒä»“çš„æœªå®ç°ç›ˆäºæ€»å’Œ
- `pnl_24h`, `pnl_7d`, `pnl_30d` = 0ï¼ˆå ä½ï¼‰

**æœªæ¥æ”¹è¿›æ–¹å‘**:
1. ä½¿ç”¨ `/info` çš„å…¶ä»–æ¥å£ï¼ˆå¦‚æœæœ‰ï¼‰
2. æœ¬åœ°è®°å½•å†å²æ•°æ®ï¼Œè®¡ç®—å·®å€¼
3. é›†æˆCoinglassç­‰ç¬¬ä¸‰æ–¹æ•°æ®æº

---

## ğŸ”„ å‘åå…¼å®¹æ€§

### ä¿ç•™çš„æ—§æ¥å£

ä¸ºç¡®ä¿å…¼å®¹æ€§ï¼Œä¿ç•™äº†ä»¥ä¸‹æ–¹æ³•ï¼š

```python
# position_manager.py
async def fetch_and_log_positions_async(addresses, max_concurrent=10)
    â†’ è¿”å› {address: [positions]} å­—å…¸ï¼ˆæ—§æ ¼å¼ï¼‰
```

è¿™ä¸ªæ–¹æ³•å†…éƒ¨è°ƒç”¨æ–°çš„ `update_and_generate_report_async()`ï¼Œå¹¶è½¬æ¢ä¸ºæ—§æ ¼å¼ã€‚

---

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬ç”¨æ³•ï¼ˆè‡ªåŠ¨ç¼“å­˜ï¼‰

```python
from position_manager import PositionManager
from hyperliquid.info import Info
from hyperliquid.utils import constants

manager = PositionManager(Info, constants)

# è·å–è´¦æˆ·æ•°æ®ï¼ˆè‡ªåŠ¨ä½¿ç”¨ç¼“å­˜ï¼‰
account_data = await manager.get_account_data_async(address)

# è·å–æŒä»“å‰3
top_positions = await manager.get_top_positions(address, top_n=3)

# è·å–æŒ‚å•å‰3
top_orders = await manager.get_top_open_orders(address, top_n=3)
```

### æ‰¹é‡æ›´æ–°å¹¶ç”ŸæˆæŠ¥å‘Š

```python
# æ›´æ–°æ‰€æœ‰åœ°å€å¹¶ç”ŸæˆHTMLæŠ¥å‘Š
all_data = await manager.update_and_generate_report_async(
    addresses=['0x...', '0x...'],
    max_concurrent=10,
    force_refresh=True  # å¼ºåˆ¶åˆ·æ–°
)
```

---

## ğŸ“š ç›¸å…³æ–‡ä»¶

- âœ… `position_manager.py` - æ ¸å¿ƒé€»è¾‘
- âœ… `create_html.py` - HTMLç”Ÿæˆ
- âœ… `monitor_whales.py` - ä¸»ç¨‹åº
- âœ… `test_position_manager.py` - æµ‹è¯•è„šæœ¬
- âœ… `README.md` - æ›´æ–°æ–‡æ¡£
- âœ… `CHANGELOG_V2.5.0.md` - æœ¬æ–‡ä»¶

---

## ğŸ¯ ä¸‹ä¸€æ­¥è®¡åˆ’

1. **PnLå†å²æ•°æ®** - æœ¬åœ°å­˜å‚¨å†å²æ•°æ®ï¼Œè®¡ç®—24h/7d/30d PnL
2. **åœ°å€æ ‡ç­¾** - ä»é…ç½®æ–‡ä»¶è¯»å–åœ°å€æ ‡ç­¾ï¼ˆæ˜µç§°ï¼‰
3. **é€šçŸ¥ä¼˜åŒ–** - æ·»åŠ Telegram/Discordé€šçŸ¥
4. **æ•°æ®å¯è§†åŒ–** - ç”ŸæˆPnLæ›²çº¿å›¾ã€æŒä»“åˆ†å¸ƒå›¾

---

## ğŸ™ è‡´è°¢

æ„Ÿè°¢Hyperliquidå›¢é˜Ÿæä¾›çš„ä¼˜ç§€APIå’ŒSDKï¼

